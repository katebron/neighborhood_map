<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: app.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: app.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/** locations to show in map &amp; UI */

/* jshint strict: true */
/*global ko*/
/**
 * Function mapApp
 * @namespace mapApp
 */
function mapApp() {
  
  var infowindow, locations, alert;


  /** set the map in portland with this lat/lang */
  var map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 45.5231, lng: -122.6765},
    zoom: 12
  });
  /** create some empty arrays to use later */
  var markers = [];
  var initialLocations = [];

  /** data for initial locations */
  initialLocations = [
    {
      title: 'Hollywood Theatre',
      address: '4122 NE Sandy Blvd, Portland, OR 97212',
      description: 'Non-profit movie theater. Alamo-like',
      url: 'http://hollywoodtheatre.org/',
      latitude: 45.535487,
      longitude: -122.620626,
      genre: 'misc',
    },
    {
      title: 'Pine Street Market',
      address: '126 SW 2nd Ave, Portland, OR 97204',
      description: 'Food hall including Salt &amp; Straw\'s whiz bang soft serve bar',
      url: 'https://www.airbnb.com',
      latitude: 45.521455,
      longitude: -122.672336,
      genre: 'food',
    },

    {
      title: 'Air b&amp;b',
      address: '745 NE Sumner St, Portland OR 97211',
      description: 'Our backyard',
      url: 'https://pinestreetmarket.squarespace.com/tenants',
      latitude: 45.560812,
      longitude: -122.657447,
      genre: 'lodging',
    },
    {
      title: 'Robert Gray Middle School',
      address: '5505 SW 23rd, Portland, OR 97239',
      description: 'Old middle school',
      url: 'http://www.pps.net/Domain/120',
      latitude: 45.482560,
      longitude: -122.701401,
      genre: 'nostalgia',
    },
    {
      title: 'Fred Meyer',
      address: '7555 SW Barbur Blvd, Portland, OR 97219',
      description: 'Freddy Meyer',
      url: '',
      latitude: 45.470554,
      longitude: -122.690408,
      genre: 'nostalgia',
    },
     {
      title: 'Powell\'s',
      address: '1005 W Burnside St, Portland, OR 97209',
      description: 'Flagship location',
      url: '',
      latitude: 45.523097,
      longitude: -122.681325,
      genre: 'bookstore',
    },
    {

      title: 'Uno Mas taquiza',
      address: '1914 W. Burnside, Portland, Oregon 97209',
      description: 'Taco place megan recommended',
      url: 'http://unomastaquiza.com/',
      latitude: 45.5228908,
      longitude: -122.6926175,
      genre: 'food',
    },
    {
      title: 'Wilson high school',
      address: '1151 SW Vermont St, Portland, OR 97219 ',
      description: 'high school near old house',
      genre: 'nostalgia',
      url: '',
      latitude: 45.4771954,
      longitude: -122.6920507,
    },
    {
      title: 'Hale Pele',
      address: '2733 NE Broadway St, Portland, OR 97232',
      description: 'Tiki bar Megan likes',
      url: 'http://halepele.com/',
      genre: 'bar',
      latitude: 45.5352796,
      longitude: -122.6394542,
    },
    {
      title: 'Sweedeedee',
      address: '5202 N. Albina Ave, Portland, OR 97217',
      description: 'Small breakfast place. Another Megan pick. Go on a weekday',
      url: 'http://www.sweedeedee.com/',
      genre: 'food',
      latitude: 45.5605478,
      longitude: -122.6748336,
    },
    {
      title: 'Little Bird Bistro',
      address: '215 SW 6th Ave, Portland, OR 97204',
      description: 'Jess pick',
      url: 'http://littlebirdbistro.com/',
      genre: 'food',
      latitude: 45.522229,
      longitude: -122.677192,
    },
    {
      title: 'Farm Spirit PDX',
      address: '1414 SE Morrison Street, Portland OR 97202',
      description: 'Jess pick: Aka Portlands most refined vegetable-focused restaurant yet',
      url: 'http://farmspiritpdx.com/',
      genre: 'food',
      latitude: 45.517108,
      longitude: -122.651217,
    },
    {
      title: 'Toro Bravo',
      address: '120 NE Russell St Portland, OR, 97212',
      description: 'Jess pick',
      url: 'http://www.torobravopdx.com/',
      genre: 'food',
      latitude: 45.517108,
      longitude: -122.651217,
    },
    {
      title: 'Nuestra Concina',
      address: '2135 SE Division Street Portland, OR 97202',
      description: 'Jess pick',
      url: 'http://nuestracocina.com/',
      genre: 'food',
      latitude: 45.505052,
      longitude: -122.643843,
    },
    {
      title: 'Tasty n Alder',
      address: '580 SW 12th Ave, Portland, OR, 97205',
      description: 'Jess pick: i can\'t eat much here but it looks good' + 
        'and i\'m sure that i could find something to eat',
      url: 'http://www.tastynalder.com/',
      genre: 'food',
      latitude: 45.521341,
      longitude: -122.683477,
    },
    {
      title: 'Mediterranean Exploration Company',
      address: '333 NW 13th Ave, Portland OR 97209',
      description: 'Jess pick: even if not on your bday,' +
        ' i\'d like to go here one night',
      url: 'http://www.mediterraneanexplorationcompany.com/',
      genre: 'food',
      latitude: 45.521341,
      longitude: -122.683477,
    },
    {
      title: 'Sauce Box',
      address: '214 sw broadway, portland, or 97205',
      description: "From Kris: I think this is where i went with Katie",
      url: 'http://www.saucebox.com/',
      genre: 'bar',
      latitude: 45.522696,
      longitude: -122.678183,
    },
    {
      title: 'Longfellows',
      address: '1401 SE Division St, Portland, OR 97202',
      description: "Mainstay for classic titles, first editions, fine bindings," +
        " rare periodicals, posters &amp; ephemera.",
      url: 'http://www.saucebox.com/',
      genre: 'bookstore',
      latitude: 45.505030,
      longitude: -122.651610,
    },
  ];

  /** build up each instance of location to have all elements be KO observables */
  /**
  * Represents a location.
  * @constructor
  */
  var Location = function(data) {  
    this.title = data.title;
    this.address = data.address;
    this.description = data.description;
    this.latitude = data.latitude;
    this.longitude = data.longitude;
    this.url = data.url;
    this.genre = data.genre;
    this.genreIcon = data.genreIcon;
    this.current = ko.observable(data.current);
    this.showInfo = ko.observable(data.showInfo);
    this.showSvg = ko.observable(false);
    this.latLng = {lat: data.latitude, lng: data.longitude};
    this.marker = new google.maps.Marker({
      position: this.latLng,
      map: map,
      icon: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png',
    });

    markers.push(this.marker); 
    this.infoW = ko.observable(data.title);
  };

 
   /**
   * Pull in info from wikipedia api and build list of article links
   */
  Location.prototype.ajax = function() {
    var self = this; 
    var title_url = "&lt;strong>&lt;a href='" + self.url + "'/>" + self.title + 
      "&lt;/a>&lt;/strong>&lt;br/>";
    var address_dir = "&lt;a href='https://www.google.com/maps?saddr=My+Location" +
      "&amp;daddr=" + self.address + "'>" + self.address + '&lt;/a>&lt;br/>';
    var heading = title_url + address_dir + "&lt;p>&lt;strong>Wiki articles from this area&lt;/strong>&lt;br/>" ;
    var links = "";
    var url = 'https://en.wikipedia.org/w/api.php?format=json' +
      '&amp;action=query&amp;list=geosearch&amp;gsradius=10000&amp;gscoord=' +
      self.latitude + '|' + self.longitude;
     
    /** begin building link to wiki pages */
    var wiki_1 = 'http://en.wikipedia.org/?curid=';
    $.ajax({
      type: "GET",
      url: url,
      dataType: "jsonp"
      })
      .done(function(data){
        $(data.query.geosearch).each(function(i, item){
          links = links + "&lt;a href='" + wiki_1+item.pageid + "'>" + item.title +  "&lt;/a>&lt;/br>";
        });
        self.infoW(heading + links + "&lt;/p>");
        infowindow.setContent(heading + links + "&lt;/p>");
        /** open info window &amp; set marker color to active blue */
        infowindow.open(map, self.marker);
        self.marker.setIcon('http://maps.google.com/mapfiles/ms/icons/blue-dot.png');
      })    
      .fail (function(){
         infowindow.setContent(heading + "no wiki articles at this time");
      }); 
      infowindow.open(map, self.marker);
    };
  
  /**
   * Function ViewModel
   * @namespace ViewModel
   * @memberof mapApp
   */
  var ViewModel = function() {
    var self = this;
    /** build empty observable arrays to fill later */
    self.locationList = ko.observableArray([]);
    self.images = ko.observableArray([]);
    infowindow = new google.maps.InfoWindow({});
  
    /** this variable will be used in the search */
    self.query = ko.observable('');

    /** sort array so it will be in alphabetical order */
    initialLocations.sort(function(a,b) {return (a.title > b.title) ? 1 : ((b.title > a.title) ? -1 : 0);} );
    /** add a few default values */
    initialLocations.forEach(function(place){
      place.current = false;
      place.showInfo = false;
      /** map icon names for genre, to be used as css classes */
      var ico = "";
      switch(place.genre) {
        case 'food':
          ico = 'icon-spoon-knife';
          break;
      case 'bar':
        ico = 'icon-glass2';
        break;
      case 'lodging':
        ico = 'icon-bed';
        break;
      case 'nostalgia':
        ico = 'icon-quill';
        break;
      case 'bookstore':
        ico = 'icon-books';
        break;
      case 'misc':
        ico = 'icon-magnet';
        break;     
      }
      place.genreIcon = ico;
    
      /** make each place an instance of location class */
      self.locationList.push(new Location(place));
    }, this);
     
  
    /** defaults for page first loading */
    self.currentLocation = ko.observable(this.locationList()[0]);
    self.typeToShow = ko.observable("all");
    
    
    /**
     * Function setCurrentLocation
     * @memberof mapApp.ViewModel
     * when a location is clicked on in the UI
    */
    this.setCurrentLocation = function(clickedLocation) {
      /** make sure other current location is not set to show as well in map */
      if (infowindow) {
        infowindow.close();
      }
      /** set the new current location */
      self.currentLocation(clickedLocation);
      reset_markers();
      self.currentLocation().current(true);
      self.currentLocation().showInfo(true);
      self.currentLocation().infoW.subscribe(function(newValue) {
      // this function will be called each time the value of infoW changed
        infowindow.setContent(newValue);
      });
      self.currentLocation().ajax();
    };
    
    /**
     * Function getImages
     * @memberof mapApp.ViewModel
     * get images that have been taken around the lat/long of current location
    */
    this.getImages = ko.computed(function() {
      self.images.removeAll();
      var lat = self.currentLocation().latitude;
      var long = self.currentLocation().longitude;   
      var flickr_key = '0ba16f70231cf1f8e6b825dfa87343d2';
      var flickr_url = 'https://api.flickr.com/services/rest/?method=flickr.photos.search&amp;api_key=' +
      flickr_key + '&amp;lat=' + lat + '&amp;lon=' + long + '&amp;radius=1&amp;page'+
      '=0&amp;per_page=5&amp;format=json&amp;nojsoncallback=1';
      /** grab a page of images from flickr. for each image, build up a 
        url for an img src, then push that to the observable images array*/
      $.ajax({
        type: "GET",
        url: flickr_url})
        .done (function(data){
        $(data.photos.photo).each(function(i,item){
          var src = "https://farm"+ item.farm +".static.flickr.com/"+ item.server +
          "/"+ item.id +"_"+ item.secret +"_m.jpg";
          self.images.push(src);
        });
      })  
      .fail (function(){
        $('#flickr_imgs').append("&lt;em>Temporarily unable to pull from the flickr API&lt;/em>");
      });
    });

    /**
     * Function locationsToShow
     * @memberof mapApp.ViewModel
     * show the list of locations on the UI
    */
    this.locationsToShow = ko.pureComputed(function() {
      /** begin a new empty array to help filter locations */
      locations = this.locationList();    
      /** first set all to false, then
       after filtering locations, set to true */
      locations.forEach(function(location) {
        location.marker.setVisible(false);
      });
      /** get search term from UI */
      var search = this.query().toLowerCase();
      /** if any search term, look for it within list */
      if (search) {
        locations = ko.utils.arrayFilter(locations, function(locale){
          return (locale.title.toLowerCase().indexOf(search) >= 0);
      });
    }
    
    /** get proper genre to show from radio buttons on UI. filter based on that */
    var desiredType = this.typeToShow();
    if (desiredType &amp;&amp; desiredType != 'all'){
      locations =  ko.utils.arrayFilter(locations, function(locale) {
        return locale.genre === desiredType;
      });
    } 

    locations.forEach(function(location){
      location.marker.setVisible(true);
      /** when a maker is clicked on in google maps */
      location.marker.addListener('click', function(){
        reset_markers();
        self.currentLocation(location);
        location.current(true);
        location.showInfo(true);
        location.ajax();
      });
    });
    
    /** return filtered list of locations */
    return locations;
  }, this);  
};

/**
 * Function reset_markers
 * close info descriptions and put marker color back to default red 
*/
function reset_markers(){
  var all = vm.locationList();
  all.forEach(function(location) {
    location.marker.setIcon('http://maps.google.com/mapfiles/ms/icons/red-dot.png');
    location.current(false);
    location.showInfo(false);
  });
}

/**
 * Function setTimeout
 * error message if google maps doesn't load in a certain amount of time 
*/
setTimeout(function(){
 if(!window.google || !window.google.maps) {
    $('#map').html('&lt;span class="error">Our apologies, Google Maps isn\'t' +
       'working at the moment for us&lt;/span>');
  }
}, 1000);

var vm = new ViewModel();
  ko.applyBindings(vm);
}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="mapApp-Location.html">Location</a></li></ul><h3>Namespaces</h3><ul><li><a href="mapApp.html">mapApp</a></li><li><a href="mapApp.ViewModel.html">ViewModel</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.2</a> on Fri Nov 25 2016 15:37:04 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
